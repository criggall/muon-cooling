

### PHYSICS ###

physics QGSP_BIC doStochastics=0

### BEAM ###

beam gaussian particle=mu+ nEvents=1 \
    beamZ=0.0 beamX=0.0 beamY=0.0 beamXp=0.0 beamYp=0.0 \ 
    sigmaX=0.0 sigmaY=0.0 sigmaXp=0.0 sigmaYp=0.0 \ 
    meanMomentum=0.0 sigmaP=0.0 meanT=0.0 sigmaT=0.0

### REFERENCE PARTICLE ###

# Initial conditions:
param X=-11.2945 #mm
param Y=14.0917 #mm
param Xp=0.823201/224.995 #radians
param Yp=-1.27215/224.995 #radians

reference referenceMomentum=200 particle=mu+ \
    beamX=$X beamY=$Y beamZ=0.0 beamXp=$Xp beamYp=$Yp

#reference referenceMomentum=200 particle=neutron \
#    beamX=0.0 beamY=0.0 beamZ=0.0 beamXp=0.0 beamYp=0.0

trace nTrace=1 format=ascii oneNTuple=1

### FIELD EXPRESSION ###

param period=4200

## Fit with one sine term and step function rotations:

#param a=0.055
#param k=0.00285714*pi
#param phi=1.55
#param b=0.069738

#fieldexpr field Bx=($a*sin($k*z+$phi)+$b)*cos(7*pi/4-floor((z-350)/700)*pi/4) \
#    By=($a*sin($k*z+$phi)+$b)*sin(7*pi/4-floor((z-350)/700)*pi/4) \
#    Bz=0 \
#    length=$period width=600 height=600

## Fit with four sine terms and no rotations:

param a=0.05489501
param k=0.00897611
param phi=1.57061852
param b=0.00804858
param c=-0.0024954
param d=-0.00184349
param offset=0.06083017

fieldexpr field Bx=($a*sin($k*z+$phi)+$b*sin($k*2*z+$phi)+$c*sin($k*3*z+$phi)+$d*sin($k*4*z+$phi)+$offset) \
    By=0 Bz=0 length=$period width=600 height=600

### SOLENOIDS ###

param sol_current=-80.46

coil coil innerRadius=420 outerRadius=600 length=300 nSheets=10 maxR=3600 maxZ=6000 dR=15 dZ=15 tolerance=0.003 

solenoid SolPos coilName=coil current=-$sol_current color=0,1,1
solenoid SolNeg coilName=coil current=$sol_current color=0,1,0

### PLACEMENT ###

param zshift=0

place field x=0 y=0 z=$period/2+$zshift

#place SolPos z=0+$zshift current=-$sol_current
#place SolNeg z=700+$zshift current=$sol_current
#place SolPos z=1400+$zshift current=-$sol_current
#place SolNeg z=2100+$zshift current=$sol_current
#place SolPos z=2800+$zshift current=-$sol_current
#place SolNeg z=3500+$zshift current=$sol_current

#do i 0 6
#    place field x=0 y=0 z=$period/6*$i
#enddo

### FIELDMAP ###

fieldntuple fieldmap format=ascii x=-200,200,10 y=-200,200,10 z=0+$zshift,4200+$zshift,10



